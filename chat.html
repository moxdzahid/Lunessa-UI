<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Customer Service Chat</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/906/906349.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #18181B;
            --bg-secondary: #27272A;
            --bg-tertiary: rgba(39, 39, 42, 0.95);
            --text-primary: #F4F4F5;
            --text-secondary: #A1A1AA;
            --text-tertiary: #71717A;
            --accent-primary: #8B5CF6;
            --accent-secondary: #7C3AED;
            --border-primary: rgba(139, 92, 246, 0.2);
            --border-secondary: rgba(139, 92, 246, 0.3);
        }

        [data-theme="light"] {
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8FAFC;
            --bg-tertiary: rgba(248, 250, 252, 0.95);
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --text-tertiary: #9CA3AF;
            --accent-primary: #8B5CF6;
            --accent-secondary: #7C3AED;
            --border-primary: rgba(139, 92, 246, 0.2);
            --border-secondary: rgba(139, 92, 246, 0.3);
        }

        [data-theme="light"] body {
            background: linear-gradient(135deg, 
                #667eea 0%, 
                #764ba2 25%, 
                #f093fb 50%, 
                #f5576c 75%, 
                #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        [data-theme="light"] body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(79, 172, 254, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .chat-container {
            display: flex;
            width: 100%;
            height: 100vh;
        }

        .sidebar {
            width: 350px;
            background: var(--bg-tertiary);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--border-primary);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-primary);
        }

        .company-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .company-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            font-weight: 600;
            margin-right: 12px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .company-details h3 {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .company-details p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .quick-actions {
            margin-top: 15px;
        }

        .quick-actions h4 {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            border-radius: 8px;
            padding-left: 0;
        }

        .action-item:hover {
            color: var(--accent-primary);
            transform: translateX(5px);
        }

        .action-item .icon {
            margin-right: 12px;
            font-size: 16px;
        }

        .conversation-section {
            padding: 20px;
            flex: 1;
        }

        .conversation-section h4 {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .new-conversation-btn {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--accent-primary);
            border: none;
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .new-conversation-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
        }

        .chat-title {
            display: flex;
            align-items: center;
        }

        .ai-status {
            display: flex;
            align-items: center;
            font-size: 16px;
            font-weight: 600;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        .chat-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid var(--border-secondary);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            margin-right: 8px;
        }

        .theme-toggle:hover {
            background: var(--accent-primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .header-btn {
            padding: 10px 16px;
            background: rgba(63, 63, 70, 0.7);
            border: 1px solid var(--border-secondary);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        [data-theme="light"] .header-btn {
            background: rgba(248, 250, 252, 0.8);
            border: 1px solid var(--border-secondary);
        }

        .header-btn:hover {
            background: rgba(139, 92, 246, 0.2);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .new-chat-btn {
            background: var(--accent-primary);
            color: var(--text-primary);
            border-color: transparent;
        }

        .new-chat-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
        }

        .end-chat-btn {
            background: #EF4444;
            color: var(--text-primary);
            border-color: transparent;
        }

        .end-chat-btn:hover {
            background: #DC2626;
            transform: translateY(-2px);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            width: 100%;
            animation: messageSlideIn 0.3s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
            justify-content: flex-start;
        }

        .message.ai {
            flex-direction: row;
            justify-content: flex-start;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .ai-avatar {
            background: var(--accent-primary);
            color: var(--text-primary);
            margin-right: 12px;
            box-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
        }

        .user-avatar {
            background: #06B6D4;
            color: var(--text-primary);
            margin-left: 12px;
            box-shadow: 0 2px 10px rgba(6, 182, 212, 0.3);
        }

        .message-wrapper {
            display: flex;
            flex-direction: column;
            max-width: 60%;
        }

        .message-content {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            padding: 12px 16px;
            border-radius: 12px;
            color: var(--text-primary);
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: anywhere;
            white-space: pre-wrap;
            border: 1px solid var(--border-primary);
        }

        .message.user .message-content {
            background: var(--accent-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-secondary);
        }

        .message-time {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 4px;
            padding: 0 4px;
        }

        .message.user .message-time {
            text-align: right;
        }

        .message.ai .message-time {
            text-align: left;
        }

        .typing-indicator {
            display: none;
            flex-direction: row;
            justify-content: flex-start;
        }

        .typing-indicator .message-content {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--accent-primary);
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDot {
            0%, 60%, 100% { opacity: 0.3; transform: translateY(0) scale(1); }
            30% { opacity: 1; transform: translateY(-4px) scale(1.2); }
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid var(--border-primary);
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
        }

        .input-wrapper {
            display: flex;
            align-items: flex-end;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 12px;
            padding: 8px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .input-wrapper:focus-within {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            min-height: 20px;
            max-height: 120px;
            line-height: 1.4;
            overflow-y: auto;
        }

        .message-input::placeholder {
            color: var(--text-tertiary);
        }

        .message-input:disabled {
            color: var(--text-secondary);
        }

        /* Custom scrollbar for message input */
        .message-input::-webkit-scrollbar {
            width: 6px;
        }

        .message-input::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 3px;
        }

        .message-input::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }

        .message-input::-webkit-scrollbar-thumb:hover {
            background: var(--accent-secondary);
        }

        .input-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 8px;
        }

        .voice-btn, .send-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .voice-btn {
            background: rgba(63, 63, 70, 0.7);
            color: var(--text-secondary);
        }

        .voice-btn:hover:not(:disabled) {
            background: rgba(139, 92, 246, 0.3);
            color: var(--text-primary);
            transform: scale(1.05);
        }

        .voice-btn.recording {
            background: #EF4444;
            color: var(--text-primary);
            animation: recordPulse 1s infinite;
        }

        .send-btn {
            background: var(--accent-primary);
            color: var(--text-primary);
        }

        .send-btn:hover:not(:disabled) {
            background: var(--accent-secondary);
            transform: scale(1.05);
        }

        .send-btn:disabled, .voice-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            opacity: 0.5;
        }

        .send-btn.processing {
            background: var(--text-secondary);
            cursor: not-allowed;
            opacity: 0.5;
            animation: processingPulse 1s infinite;
        }

        @keyframes processingPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.7; }
        }

        @keyframes recordPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                backdrop-filter: blur(0px);
            }
            to {
                opacity: 1;
                backdrop-filter: blur(5px);
            }
        }

        .modal-content {
            background: var(--bg-tertiary);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-secondary);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideUp 0.3s ease-out;
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal h3 {
            margin-bottom: 16px;
            color: var(--text-primary);
            font-size: 24px;
        }

        .modal p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 16px;
        }

        .rating-container {
            margin: 30px 0;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: 16px;
            border: 1px solid var(--border-primary);
        }

        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
        }

        .star {
            font-size: 32px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .star:hover {
            transform: scale(1.2) rotate(15deg);
            color: #FBBF24;
        }

        .star.active {
            color: #FBBF24;
            transform: scale(1.1);
            animation: starGlow 0.5s ease-out;
        }

        @keyframes starGlow {
            0% { transform: scale(1.1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.1); }
        }

        .feedback-textarea {
            width: 100%;
            background: var(--bg-primary);
            border: 1px solid var(--border-secondary);
            border-radius: 12px;
            padding: 16px;
            color: var(--text-primary);
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .feedback-textarea::placeholder {
            color: var(--text-tertiary);
        }

        .feedback-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .modal-btn {
            background: var(--accent-primary);
            color: var(--text-primary);
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .modal-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .modal-btn.secondary {
            background: rgba(82, 82, 91, 0.8);
            box-shadow: 0 4px 15px rgba(82, 82, 91, 0.3);
        }

        .modal-btn.secondary:hover {
            background: rgba(113, 113, 122, 0.8);
            box-shadow: 0 6px 20px rgba(113, 113, 122, 0.4);
        }

        .rating-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 12px;
            color: var(--text-tertiary);
            font-style: italic;
        }

        .chat-ended-message {
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            margin: 20px;
            color: var(--text-secondary);
            backdrop-filter: blur(10px);
            animation: messageSlideIn 0.5s ease-out;
        }

        .chat-ended-message h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 20px;
        }

        .chat-ended-message .icon {
            font-size: 48px;
            margin-bottom: 16px;
            animation: bounce 1s ease-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .disabled-input {
            opacity: 0.5;
            pointer-events: none;
        }

        /* Scrollbar styling for chat messages */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: var(--accent-secondary);
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 280px;
            }
            
            .message-wrapper {
                max-width: 75%;
            }

            .chat-actions {
                flex-wrap: wrap;
                gap: 8px;
            }

            .theme-toggle {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
        }

        @media (max-width: 640px) {
            .sidebar {
                display: none;
            }
            
            .chat-container {
                flex-direction: column;
            }

            .message-wrapper {
                max-width: 85%;
            }
        }

        @media (max-width: 480px) {
            .message-wrapper {
                max-width: 90%;
            }
            
            .message-content {
                font-size: 13px;
            }
            
            .chat-messages {
                padding: 15px;
            }
            
            .modal-content {
                padding: 30px 20px;
                margin: 20px;
            }
        }

        .logo-wrap {
            width: 44px; 
            height: 44px; 
            flex: 0 0 44px; 
            display: grid; 
            place-items: center;
            background: linear-gradient(145deg, rgba(96,165,250,.25), rgba(14,165,233,.2));
            border: 1px solid rgba(96,165,250,.35);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(2,6,23,.45);
        }

        .logo-wrap img { 
            width: 28px; 
            height: 28px; 
            display: block; 
        }

        /* Processing state styles */
        .processing-state .message-input:disabled {
            opacity: 0.6;
        }

        .processing-state .voice-btn:disabled {
            opacity: 0.6;
        }

        .processing-notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        [data-theme="light"] .sidebar {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(139, 92, 246, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        [data-theme="light"] .main-chat {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
        }

        [data-theme="light"] .chat-header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(139, 92, 246, 0.15);
        }

        [data-theme="light"] .chat-input-container {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(139, 92, 246, 0.15);
        }

        [data-theme="light"] .message-content {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        [data-theme="light"] .message.user .message-content {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
            color: #FFFFFF;
            border: 1px solid rgba(139, 92, 246, 0.3);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2);
        }

        [data-theme="light"] .input-wrapper {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .file-btn {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
}

.file-preview {
    display: flex;
    gap: 8px;
    margin-top: 5px;
    flex-wrap: wrap;
}

.file-item {
    position: relative;
    display: inline-block;
}

.file-item img {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 6px;
    border: 1px solid #ccc;
}

.remove-file {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4d4d;
    border: none;
    color: white;
    border-radius: 50%;
    font-size: 12px;
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

#dropZone {
    border: 2px dashed transparent;
    transition: border-color 0.2s;
}

#dropZone.drag-over {
    border-color: #22C55E;
    background-color: rgba(34,197,94,0.1);
}


    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="company-info">
                    <div class="logo-wrap" aria-hidden="true">
                        <img src="https://cdn-icons-png.flaticon.com/512/906/906349.png" alt="CS Logo" />
                    </div>
                    <div class="company-details">
                        <h3 id="companyName">Lunessa</h3>
                        <p>Customer Service Agent</p>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <h4>Quick actions</h4>
                    <div class="action-item" id="talkToHuman">
                        <span class="icon">üë§</span>
                        Talk to human
                    </div>
                    <div class="action-item" id="callSupport">
                        <span class="icon">üìû</span>
                        +1 (800) 123-456
                    </div>
                    <div class="action-item">
                        <span class="icon">üîí</span>
                        Secure & private
                    </div>
                </div>
            </div>
            
            <div class="conversation-section">
                <h4>Conversation</h4>
                <div class="new-conversation-btn" id="newConversationBtn">
                    <span>‚ú® New conversation</span>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-chat">
            <div class="chat-header">
                <div class="chat-title">
                    <div class="ai-status">
                        <div class="status-dot"></div>
                        AI Assistant
                    </div>
                    <div style="margin-left: 16px; font-size: 13px; color: var(--text-secondary);">Online</div>
                </div>
                <div class="chat-actions">
                    <button class="theme-toggle" id="themeToggle" title="Toggle theme">üåô</button>
                    <button class="header-btn new-chat-btn" id="newChatBtn">‚ú® New chat</button>
                    <button class="header-btn end-chat-btn" id="endChatBtn">üõë End chat</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    <div class="message-avatar ai-avatar">AI</div>
                    <div class="message-wrapper">
                        <div class="message-content">Hi! I'm your virtual assistant. Ask me about orders, refunds, or request a human agent. How can I help you today?</div>
                        <div class="message-time">10:43 AM</div>
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar ai-avatar">AI</div>
                <div class="message-wrapper">
                    <div class="message-content">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <div class="chat-input-container" id="chatInputContainer">
    <div class="input-wrapper" id="dropZone">
        <textarea 
            id="messageInput" 
            class="message-input" 
            placeholder="Type your message or drop files..."
            rows="1"
        ></textarea>
        <div class="input-actions">
            <input type="file" id="fileInput" hidden multiple accept="image/*">
            <button class="file-btn" id="fileBtn" title="Add files">üìé</button>
            <button class="voice-btn" id="voiceBtn" title="Voice input">üé§</button>
            <button class="send-btn" id="sendBtn" title="Send message">‚û§</button>
        </div>
    </div>
    <div id="filePreview" class="file-preview"></div>
    <div class="processing-notification" id="processingNotification">
        AI is processing your message...
    </div>
</div>


        </div>
    </div>

    <!-- Enhanced Rating Modal -->
    <div class="modal" id="ratingModal">
        <div class="modal-content">
            <div class="icon">‚≠ê</div>
            <h3>Rate Your Experience</h3>
            <p>Your feedback is valuable to us! Please rate your chat experience and let us know how we did.</p>
            
            <div class="rating-container">
                <div class="rating-stars" id="ratingStars">
                    <span class="star" data-rating="1">‚≠ê</span>
                    <span class="star" data-rating="2">‚≠ê</span>
                    <span class="star" data-rating="3">‚≠ê</span>
                    <span class="star" data-rating="4">‚≠ê</span>
                    <span class="star" data-rating="5">‚≠ê</span>
                </div>
                <div class="rating-labels">
                    <span>Poor</span>
                    <span>Excellent</span>
                </div>
            </div>
            
            <textarea 
                id="feedbackText" 
                class="feedback-textarea" 
                placeholder="Share your thoughts about the service... (optional)"
                maxlength="500"
            ></textarea>
            
            <div>
                <button class="modal-btn" id="submitRating">Submit Review</button>
                <button class="modal-btn secondary" id="skipRating">Maybe Later</button>
            </div>
        </div>
    </div>

    <script>
        class AICustomerService {
            constructor() {
                this.messages = [];
                this.isRecording = false;
                this.recognition = null;
                this.currentRating = 0;
                this.chatEnded = false;
                this.isProcessing = false; // New property to track AI processing state
                this.currentTheme = localStorage.getItem('theme') || 'dark';
                
                this.initElements();
                this.initEventListeners();
                this.initSpeechRecognition();
                this.initTheme();
                this.autoResize();
            }

            initElements() {
                this.chatMessages = document.getElementById('chatMessages');
                this.messageInput = document.getElementById('messageInput');
                this.sendBtn = document.getElementById('sendBtn');
                this.voiceBtn = document.getElementById('voiceBtn');
                this.typingIndicator = document.getElementById('typingIndicator');
                this.ratingModal = document.getElementById('ratingModal');
                this.companyName = document.getElementById('companyName');
                this.chatInputContainer = document.getElementById('chatInputContainer');
                this.endChatBtn = document.getElementById('endChatBtn');
                this.feedbackText = document.getElementById('feedbackText');
                this.themeToggle = document.getElementById('themeToggle');
                this.processingNotification = document.getElementById('processingNotification');
            }

            initEventListeners() {
                this.sendBtn.addEventListener('click', () => this.sendMessage());
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                this.messageInput.addEventListener('input', () => {
                    this.autoResize();
                    this.updateSendButton();
                });

                this.voiceBtn.addEventListener('click', () => this.toggleVoiceInput());

                // Theme toggle
                this.themeToggle.addEventListener('click', () => this.toggleTheme());

                // Sidebar actions
                document.getElementById('newConversationBtn').addEventListener('click', () => this.startNewChat());
                document.getElementById('newChatBtn').addEventListener('click', () => this.startNewChat());
                document.getElementById('endChatBtn').addEventListener('click', () => this.endChat());
                document.getElementById('talkToHuman').addEventListener('click', () => this.requestHuman());
                document.getElementById('callSupport').addEventListener('click', () => this.callSupport());

                // Rating modal
                document.querySelectorAll('.star').forEach(star => {
                    star.addEventListener('click', (e) => {
                        this.currentRating = parseInt(e.target.dataset.rating);
                        this.updateStars();
                    });
                });

                document.getElementById('submitRating').addEventListener('click', () => this.submitRating());
                document.getElementById('skipRating').addEventListener('click', () => this.skipRating());
            }

            initSpeechRecognition() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new webkitSpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.messageInput.value = transcript;
                        this.autoResize();
                        this.updateSendButton();
                        this.stopRecording();
                    };

                    this.recognition.onerror = () => this.stopRecording();
                    this.recognition.onend = () => this.stopRecording();
                }
            }

            initTheme() {
                document.documentElement.setAttribute('data-theme', this.currentTheme);
                this.updateThemeToggleIcon();
            }

            toggleTheme() {
                this.currentTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', this.currentTheme);
                localStorage.setItem('theme', this.currentTheme);
                this.updateThemeToggleIcon();
                
                // Add a subtle animation effect
                document.body.style.transition = 'all 0.3s ease';
                setTimeout(() => {
                    document.body.style.transition = '';
                }, 300);
            }

            updateThemeToggleIcon() {
                this.themeToggle.textContent = this.currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                this.themeToggle.title = `Switch to ${this.currentTheme === 'dark' ? 'light' : 'dark'} theme`;
            }

            autoResize() {
                this.messageInput.style.height = 'auto';
                this.messageInput.style.height = Math.min(this.messageInput.scrollHeight, 120) + 'px';
            }

            updateSendButton() {
                const hasText = this.messageInput.value.trim().length > 0;
                this.sendBtn.disabled = !hasText || this.chatEnded || this.isProcessing;
                
                // Update button appearance based on processing state
                if (this.isProcessing) {
                    this.sendBtn.classList.add('processing');
                } else {
                    this.sendBtn.classList.remove('processing');
                }
            }

            setProcessingState(processing) {
                this.isProcessing = processing;
                
                // Update input container visual state
                if (processing) {
                    this.chatInputContainer.classList.add('processing-state');
                    this.messageInput.disabled = true;
                    this.voiceBtn.disabled = true;
                    this.showProcessingNotification();
                } else {
                    this.chatInputContainer.classList.remove('processing-state');
                    if (!this.chatEnded) {
                        this.messageInput.disabled = false;
                        this.voiceBtn.disabled = false;
                    }
                    this.hideProcessingNotification();
                }
                
                this.updateSendButton();
            }

            showProcessingNotification() {
                this.processingNotification.classList.add('show');
            }

            hideProcessingNotification() {
                this.processingNotification.classList.remove('show');
            }

            sendMessage() {
                if (this.chatEnded || this.isProcessing) {
                    return; // Prevent sending if AI is processing or chat has ended
                }
                
                const message = this.messageInput.value.trim();
                if (!message) return;

                this.addMessage(message, 'user');
                this.messageInput.value = '';
                this.autoResize();
                
                // Set processing state before generating response
                this.setProcessingState(true);

                // Generate AI response with processing state
                this.showTypingIndicator();
                setTimeout(() => this.generateAIResponse(message), Math.random() * 1000 + 1000);
            }

            isGoodbyeMessage(message) {
                const goodbyeKeywords = ['bye', 'goodbye', 'thanks', 'thank you', 'done', 'finished', 'end chat', 'that\'s all', 'see you', 'have a good day', 'stop', 'quit'];
                return goodbyeKeywords.some(keyword => message.includes(keyword));
            }

            addMessage(content, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;

                const avatar = document.createElement('div');
                avatar.className = `message-avatar ${sender}-avatar`;
                avatar.textContent = sender === 'ai' ? 'AI' : 'U';

                const messageWrapper = document.createElement('div');
                messageWrapper.className = 'message-wrapper';

                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                messageContent.textContent = content;

                const messageTime = document.createElement('div');
                messageTime.className = 'message-time';
                messageTime.textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

                messageWrapper.appendChild(messageContent);
                messageWrapper.appendChild(messageTime);
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageWrapper);

                this.chatMessages.appendChild(messageDiv);
                this.scrollToBottom();
                this.messages.push({content, sender, timestamp: new Date()});
            }

            generateAIResponse(userMessage) {
                this.hideTypingIndicator();
                let response = this.getAIResponse(userMessage.toLowerCase());
                this.addMessage(response, 'ai');
                
                // Clear processing state after AI responds
                this.setProcessingState(false);
            }

            getAIResponse(message) {
                const responses = {
                    'hello': 'Hello! Welcome to our customer service. How can I assist you today?',
                    'hi': 'Hi there! I\'m here to help. What can I do for you?',
                    'help': 'I\'d be happy to help! Please describe your issue or question in detail.',
                    'order': 'I can help you with order-related questions. Please provide your order number or tell me more about your order concern.',
                    'refund': 'I can assist with refund requests. Could you please share your order details and the reason for the refund?',
                    'human': 'I understand you\'d like to speak with a human agent. Let me connect you with our support team right away.',
                    'problem': 'I understand you\'re experiencing an issue. Can you provide more details so I can better assist you?',
                    'shipping': 'I can help with shipping inquiries. Please provide your tracking number or order details.',
                    'account': 'I can assist with account-related questions. What specific account issue are you experiencing?',
                    'payment': 'I can help with payment and billing questions. What payment issue can I assist you with?',
                    'cancel': 'I can help you with cancellation requests. Please provide your order number and I\'ll check the status.',
                    'return': 'I can assist with returns. Please tell me about the item you\'d like to return and your order number.',
                    'thank': 'You\'re very welcome! It was my pleasure helping you today. Is there anything else I can assist you with?',
                    'bye': 'You\'re welcome! I\'m glad I could help. If you need to officially end our chat, please click the "End Chat" button above. Is there anything else I can help you with?',
                    'goodbye': 'Thank you for the kind words! If you\'re ready to end our conversation, please use the "End Chat" button. Otherwise, I\'m here if you need more help!',
                    'done': 'Great! I\'m happy I could assist you. If you\'re finished, feel free to click "End Chat" above. Otherwise, I\'m here for any other questions!',
                    'finished': 'Wonderful! If you\'re all set, you can end our chat using the button above. I\'m still here if you need anything else!',
                };

                // Check for specific keywords
                for (let key in responses) {
                    if (message.includes(key)) {
                        return responses[key];
                    }
                }

                // Default responses based on message sentiment
                const helpfulResponses = [
                    'I understand your concern. Let me help you with that. Could you provide more specific details?',
                    'Thank you for reaching out. I\'m here to assist you. Can you tell me more about what you need help with?',
                    'I\'d be happy to help resolve this for you. Please share more details about your situation.',
                    'I see what you\'re asking about. Let me provide you with the best assistance possible. Could you elaborate on your request?'
                ];

                return helpfulResponses[Math.floor(Math.random() * helpfulResponses.length)];
            }

            endChat() {
                if (this.chatEnded) return;
                
                this.chatEnded = true;
                this.setProcessingState(false); // Clear any processing state
                
                // Add a farewell message from AI before ending
                this.addMessage('Thank you for using our customer service! I hope I was able to help you today. üòä', 'ai');
                
                // Disable all interactive elements after a brief delay
                setTimeout(() => {
                    this.messageInput.disabled = true;
                    this.sendBtn.disabled = true;
                    this.voiceBtn.disabled = true;
                    this.endChatBtn.disabled = true;
                    
                    // Add visual feedback
                    this.chatInputContainer.classList.add('disabled-input');
                    this.messageInput.placeholder = "Chat has ended. Start a new conversation to continue.";
                    
                    // Show chat ended message with animation
                    this.showChatEndedMessage();
                    
                    // Show rating modal after a brief delay
                    setTimeout(() => this.showRatingModal(), 2000);
                }, 1000);
            }

            showChatEndedMessage() {
                const endedDiv = document.createElement('div');
                endedDiv.className = 'chat-ended-message';
                endedDiv.innerHTML = `
                    <div class="icon">üéâ</div>
                    <h3>Chat Session Complete</h3>
                    <p>Thank you for using our customer service! We hope we were able to help you today. Your feedback would be greatly appreciated.</p>
                `;
                this.chatMessages.appendChild(endedDiv);
                this.scrollToBottom();
            }

            toggleVoiceInput() {
                if (this.chatEnded || this.isProcessing) return;
                
                if (this.isRecording) {
                    this.stopRecording();
                } else {
                    this.startRecording();
                }
            }

            startRecording() {
                if (this.recognition && !this.chatEnded && !this.isProcessing) {
                    this.isRecording = true;
                    this.voiceBtn.classList.add('recording');
                    this.recognition.start();
                }
            }

            stopRecording() {
                this.isRecording = false;
                this.voiceBtn.classList.remove('recording');
                if (this.recognition) {
                    this.recognition.stop();
                }
            }

            startNewChat() {
                this.chatEnded = false;
                this.messages = [];
                this.currentRating = 0;
                this.setProcessingState(false); // Reset processing state
                this.updateStars();
                
                // Re-enable input elements
                this.messageInput.disabled = false;
                this.sendBtn.disabled = false;
                this.voiceBtn.disabled = false;
                this.endChatBtn.disabled = false;
                this.chatInputContainer.classList.remove('disabled-input');
                this.messageInput.placeholder = "Type your message or press the mic...";
                
                // Reset chat messages
                this.chatMessages.innerHTML = `
                    <div class="message ai">
                        <div class="message-avatar ai-avatar">AI</div>
                        <div class="message-wrapper">
                            <div class="message-content">Hi! I'm your virtual assistant. Ask me about orders, refunds, or request a human agent. How can I help you today?</div>
                            <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                        </div>
                    </div>
                `;
                
                this.hideRatingModal();
                this.updateSendButton();
            }

            requestHuman() {
                if (this.chatEnded || this.isProcessing) return;
                
                this.addMessage('I\'d like to speak with a human agent, please.', 'user');
                
                this.setProcessingState(true);
                setTimeout(() => {
                    this.showTypingIndicator();
                    setTimeout(() => {
                        this.hideTypingIndicator();
                        this.addMessage('I\'m connecting you with a human agent now. Please hold on for a moment while I transfer you...', 'ai');
                        setTimeout(() => {
                            this.addMessage('A human agent will be with you shortly. Please stay on the line. Is there anything specific you\'d like me to note for the agent?', 'ai');
                            this.setProcessingState(false);
                        }, 2500);
                    }, 1500);
                }, 1000);
            }

            callSupport() {
                if (this.chatEnded || this.isProcessing) return;
                this.addMessage('I\'ve initiated a call connection to our support line at +1 (800) 123-456. You should receive a call shortly, or you can dial the number directly.', 'ai');
            }

            showTypingIndicator() {
                if (!this.chatEnded) {
                    this.typingIndicator.style.display = 'flex';
                    this.scrollToBottom();
                }
            }

            hideTypingIndicator() {
                this.typingIndicator.style.display = 'none';
            }

            showRatingModal() {
                this.ratingModal.style.display = 'flex';
                // Focus on the modal for accessibility
                setTimeout(() => {
                    const firstStar = document.querySelector('.star');
                    if (firstStar) firstStar.focus();
                }, 300);
            }

            hideRatingModal() {
                this.ratingModal.style.display = 'none';
                this.currentRating = 0;
                this.updateStars();
                this.feedbackText.value = '';
            }

            updateStars() {
                document.querySelectorAll('.star').forEach((star, index) => {
                    star.classList.toggle('active', index < this.currentRating);
                });
            }

            submitRating() {
                const feedbackText = this.feedbackText.value.trim();
                let confirmationMessage = '';
                
                if (this.currentRating > 0) {
                    const ratingText = this.currentRating === 1 ? 'star' : 'stars';
                    confirmationMessage = `Thank you for rating us ${this.currentRating} ${ratingText}! ‚≠ê`;
                    
                    if (feedbackText) {
                        confirmationMessage += ' Your detailed feedback has been recorded and will help us improve our service.';
                    } else {
                        confirmationMessage += ' Your rating helps us understand how we\'re doing.';
                    }
                    
                    // Save the review
                    this.saveReview(this.currentRating, feedbackText);
                } else {
                    confirmationMessage = 'Thank you for your time! Your feedback helps us improve our service.';
                }
                
                // Show confirmation in chat
                setTimeout(() => {
                    this.addMessage(confirmationMessage, 'ai');
                    this.showThankYouMessage();
                }, 500);
                
                this.hideRatingModal();
            }

            saveReview(rating, feedback) {
                const reviewData = {
                    rating: rating,
                    feedback: feedback,
                    timestamp: new Date().toISOString(),
                    sessionId: this.generateSessionId(),
                    messageCount: this.messages.length,
                    sessionDuration: this.calculateSessionDuration(),
                    userAgent: navigator.userAgent,
                    resolvedIssue: rating >= 4,
                    theme: this.currentTheme
                };
                
                console.log('Review submitted:', reviewData);
            }

            calculateSessionDuration() {
                if (this.messages.length > 0) {
                    const firstMessage = this.messages[0];
                    const lastMessage = this.messages[this.messages.length - 1];
                    return Math.round((lastMessage.timestamp - firstMessage.timestamp) / 1000);
                }
                return 0;
            }

            generateSessionId() {
                return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            skipRating() {
                this.addMessage('Thank you for using our service! Have a wonderful day! üåü', 'ai');
                this.hideRatingModal();
                this.showThankYouMessage();
            }

            showThankYouMessage() {
                setTimeout(() => {
                    const thankYouDiv = document.createElement('div');
                    thankYouDiv.className = 'chat-ended-message';
                    thankYouDiv.innerHTML = `
                        <div class="icon">üôè</div>
                        <h3>Thank You!</h3>
                        <p>We appreciate your time and feedback. Feel free to start a new conversation anytime you need assistance!</p>
                        <br>
                        <button class="modal-btn" onclick="window.location.reload()">Start New Chat</button>
                    `;
                    this.chatMessages.appendChild(thankYouDiv);
                    this.scrollToBottom();
                }, 1000);
            }

            scrollToBottom() {
                requestAnimationFrame(() => {
                    this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
                });
            }
        }

        // Initialize the chat service when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new AICustomerService();
        });

        // Add some global styles for better UX
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('ratingModal');
                if (modal.style.display === 'flex') {
                    document.getElementById('skipRating').click();
                }
            }
        });
        const fileBtn = document.getElementById('fileBtn');
const fileInput = document.getElementById('fileInput');
const dropZone = document.getElementById('dropZone');
const filePreview = document.getElementById('filePreview');

let selectedFiles = [];

fileBtn.addEventListener('click', () => fileInput.click());

fileInput.addEventListener('change', (e) => {
    addFiles([...e.target.files]);
    fileInput.value = ''; // allow re-select same file
});

dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.classList.add('drag-over');
});

dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('drag-over');
});

dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    addFiles([...e.dataTransfer.files]);
});

function addFiles(files) {
    files.forEach(file => {
        if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
            selectedFiles.push(file);
        }
    });
    renderFilePreview();
}

function renderFilePreview() {
    filePreview.innerHTML = '';
    selectedFiles.forEach((file, index) => {
        if (file.type.startsWith('image/')) {
            const fileItem = document.createElement('div');
            fileItem.classList.add('file-item');

            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);

            const removeBtn = document.createElement('button');
            removeBtn.classList.add('remove-file');
            removeBtn.innerHTML = '‚úï';
            removeBtn.onclick = () => removeFile(index);

            fileItem.appendChild(img);
            fileItem.appendChild(removeBtn);
            filePreview.appendChild(fileItem);
        }
    });
}

function removeFile(index) {
    selectedFiles.splice(index, 1);
    renderFilePreview();
}


    </script>
</body>
</html>
